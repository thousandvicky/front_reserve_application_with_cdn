<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="/assets/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Paper Dashboard 2 by Creative Tim
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
    name='viewport' />
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/assets/css/paper-dashboard.css?v=2.0.1" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="/assets/demo/demo.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/vue-router@3.5.1/dist/vue-router.js"></script>
</head>

<body class="">
  <div class="wrapper">
    <div class="sidebar" data-color="white" data-active-color="danger">
      <div class="logo">
        <a href="https://www.creative-tim.com" class="simple-text logo-mini">
          <div class="logo-image-small">
            <img src="/assets/img/logo-small.png">
          </div>
          <!-- <p>CT</p> -->
        </a>
        <a href="https://www.creative-tim.com" class="simple-text logo-normal">
          Creative Tim
          <!-- <div class="logo-image-big">
            <img src="../assets/img/logo-big.png">
          </div> -->
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li>
            <a href="./dashboard.html">
              <i class="nc-icon nc-bank"></i>
              <p>Dashboard</p>
            </a>
          </li>
          <li>
            <a href="./icons.html">
              <i class="nc-icon nc-diamond"></i>
              <p>Icons</p>
            </a>
          </li>
          <li>
            <a href="./map.html">
              <i class="nc-icon nc-pin-3"></i>
              <p>Maps</p>
            </a>
          </li>
          <li>
            <a href="./notifications.html">
              <i class="nc-icon nc-bell-55"></i>
              <p>Notifications</p>
            </a>
          </li>
          <li>
            <a href="./user.html">
              <i class="nc-icon nc-single-02"></i>
              <p>User Profile</p>
            </a>
          </li>
          <li class="active ">
            <a href="./tables.html">
              <i class="nc-icon nc-tile-56"></i>
              <p>Table List</p>
            </a>
          </li>
          <li>
            <a href="./typography.html">
              <i class="nc-icon nc-caps-small"></i>
              <p>Typography</p>
            </a>
          </li>
          <li class="active-pro">
            <a href="./upgrade.html">
              <i class="nc-icon nc-spaceship"></i>
              <p>Upgrade to PRO</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <div class="navbar-toggle">
              <button type="button" class="navbar-toggler">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
              </button>
            </div>
            <a class="navbar-brand" href="javascript:;">Paper Dashboard 2</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
            aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end" id="navigation">
            <form>
              <div class="input-group no-border">
                <input type="text" value="" class="form-control" placeholder="Search...">
                <div class="input-group-append">
                  <div class="input-group-text">
                    <i class="nc-icon nc-zoom-split"></i>
                  </div>
                </div>
              </div>
            </form>
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link btn-magnify" href="javascript:;">
                  <i class="nc-icon nc-layout-11"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Stats</span>
                  </p>
                </a>
              </li>
              <li class="nav-item btn-rotate dropdown">
                <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="nc-icon nc-bell-55"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Some Actions</span>
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="#">Action</a>
                  <a class="dropdown-item" href="#">Another action</a>
                  <a class="dropdown-item" href="#">Something else here</a>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link btn-rotate" href="javascript:;">
                  <i class="nc-icon nc-settings-gear-65"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Account</span>
                  </p>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div id="application" class="content">
        <guest></guest>
        <service></service>
        <reserve></reserve>
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">サービス一覧</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table">
                    <thead class=" text-primary">
                      <th>レンタル可能なサービス</th>
                      <th>サービスタイプ</th>
                      <th>一括価格</th>
                      <th>時間単価</th>
                    </thead>
                    <tbody>
                      <tr v-for="(value, index) in services">
                        <td><a v-on:click="getReserves(value.id)">{{value.service_name}}</a></td>
                        <td>{{value.service_type}}</td>
                        <td>{{value.price}}</td>
                        <td>{{value.price_per_hour}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">予約一覧</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table">
                    <thead class=" text-primary">
                      <th>予約ゲスト名</th>
                      <th>予約開始日時<br>予約終了日時</th>
                      <th>予約作成日時<br>予約更新日時</th>
                      <th class="text-right">
                        Salary
                      </th>
                    </thead>
                    <tbody>
                      <tr v-for="(value, index) in reserves">
                        <td><a v-on:click="moveGuestPage(value.guest.id)">
                          {{value.guest.guest_name}}<br>({{value.guest.guest_name_sort}})
                        </a></td>
                        <td>{{value.from_datetime_ja}}<br>{{value.to_datetime_ja}}</td>
                        <td>{{value.created_at_ja}}<br>{{value.updated_at_ja}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer class="footer footer-black  footer-white ">
        <div class="container-fluid">
          <div class="row">
            <nav class="footer-nav">
              <ul>
                <li><a href="https://www.creative-tim.com" target="_blank">Creative Tim</a></li>
                <li><a href="https://www.creative-tim.com/blog" target="_blank">Blog</a></li>
                <li><a href="https://www.creative-tim.com/license" target="_blank">Licenses</a></li>
              </ul>
            </nav>
            <div class="credits ml-auto">
              <span class="copyright">
                ©
                <script>
                  document.write( new Date().getFullYear() )
                </script>, made with <i class="fa fa-heart heart"></i> by Creative Tim
              </span>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="/assets/js/core/jquery.min.js"></script>
  <script src="/assets/js/core/popper.min.js"></script>
  <script src="/assets/js/core/bootstrap.min.js"></script>
  <script src="/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!--  Google Maps Plugin    -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
  <!-- Chart JS -->
  <script src="/assets/js/plugins/chartjs.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="/assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/assets/js/paper-dashboard.min.js?v=2.0.1" type="text/javascript"></script>
  <!-- Paper Dashboard DEMO methods, don't include it in your project! -->
  <!-- <script src="../assets/demo/demo.js"></script> -->


  <script type="text/x-template" id="guest">
    <!-- ゲスト詳細情報をここに記述-->
    <div id="guest-information" class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title"> ゲスト情報 {{guest.guest_name}}さんの詳細情報</h4>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead class=" text-primary">
                  <th>ゲスト氏名</th>
                  <th>注意事項</th>
                  <th>予約作成日時</th>
                  <th>予約更新日時</th>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      {{guest.family_name}} {{guest.given_name}}<br>
                      {{guest.family_name_sort}} {{guest.given_name_sort}}</td>
                    <td>{{guest.memo}}</td>
                    <td v-html="guest.created_at"></td>
                    <td v-html="guest.updated_at"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-12">
        <div class="card card-user">
          <div class="card-header">
            <h5 class="card-title">ゲスト情報の更新</h5>
          </div>
          <div class="card-body">
            <form>

              <div class="row">
                <div class="col-md-6 pr-1">
                  <div class="form-group">
                    <label>名字</label>
                    <input v-model="guest.family_name" type="text" class="form-control" placeholder="Company" value="">
                  </div>
                </div>
                <div class="col-md-6 pl-1">
                  <div class="form-group">
                    <label>名前</label>
                    <input v-model="guest.given_name" type="text" class="form-control" placeholder="Username" value="michael23">
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 pr-1">
                  <div class="form-group">
                    <label>名字(ひらがな)</label>
                    <input v-model="guest.family_name_sort" type="text" class="form-control" placeholder="Company" value="">
                  </div>
                </div>
                <div class="col-md-6 pl-1">
                  <div class="form-group">
                    <label>名前(ひらがな)</label>
                    <input v-model="guest.given_name_sort" type="text" class="form-control" placeholder="Username" value="michael23">
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 pr-1">
                  <div class="form-group">
                    <label>電話番号</label>
                    <input v-model="guest.phone_number" type="text" class="form-control" placeholder="Company" value="Chet">
                  </div>
                </div>
                <div class="col-md-6 pl-1">
                  <div class="form-group">
                    <label>メールアドレス</label>
                    <input v-model="guest.email" type="text" class="form-control" placeholder="Last Name" value="Faker">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label>Address</label>
                    <input type="text" class="form-control" placeholder="Home Address" value="Melbourne, Australia">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 pr-1">
                  <div class="form-group">
                    <label>City</label>
                    <input type="text" class="form-control" placeholder="City" value="Melbourne">
                  </div>
                </div>
                <div class="col-md-4 px-1">
                  <div class="form-group">
                    <label>Country</label>
                    <input type="text" class="form-control" placeholder="Country" value="Australia">
                  </div>
                </div>
                <div class="col-md-4 pl-1">
                  <div class="form-group">
                    <label>Postal Code</label>
                    <input type="number" class="form-control" placeholder="ZIP Code">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label>予約時のメッセージ</label>
                    <textarea v-model="guest.option" class="form-control textarea"></textarea>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="form-group">
                    <label>管理側メモ</label>
                    <textarea v-model="guest.memo" class="form-control textarea"></textarea>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="update ml-auto mr-auto">
                  <button v-on:click="updateGuestInfo(guest.id)" type="button" class="btn btn-primary btn-round">ゲスト情報を更新</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-template" id="service">
    <!-- ゲスト詳細情報をここに記述-->
    <p>これはサービス情報です｡</p>
  </script>

  <script type="text/x-template" id="reserve">
    <!-- ゲスト詳細情報をここに記述-->
    <p>これはリザーブ情報です｡</p>
  </script>

  <script>
    let baseUrl="http://localhost:8000";
    const Guest = Vue.component("guest" , {
      data: function () {
        return {
          guest: {
            family_name: "",
            family_name_sort: "",
            given_name: "",
            given_name_sort: "",
            email: "",
            phone_number: "",
            option: "",
            memo: "",
          },
          guest_id: null,
        }
      },
      created: function () {
        // console.dir("created");
        // console.dir(this.$router);
        // console.dir(this.$route);
        // console.dir("created");
        this.guest_id = this.$route.params.id;
        this.getGuestInfo(this.guest_id);
      },
      template: "#guest",
      watch: {
        $route(to, from) {
          this.getGuestInfo(to.params.id);
          // alert(to);
          // alert(from);
          console.dir(to.params);
          console.dir(from.params);
        }
      },
      beforeRouteUpdate(to, from, next) {
        // console.dir(to);
        // console.dir(from);
        // ルート変更に反応する...
        // next() を呼び出すのを忘れないでください
        next();
      },
      methods: {
        getGuestInfo: function (guest_id) {
          // リクエスト先エンドポイント
          let apiUrl=baseUrl+"/api/v1/front/guest/" + guest_id;
          let self = this;
          axios.get(apiUrl).then( function ( response ) {
            // console.dir(response);
            self.guest = response.data.data;
          } ).catch( function ( error ) {
            // console.dir(error);
          } );
        },
        updateGuestInfo: function (guest_id) {
          let apiUrl=baseUrl+"/api/v1/front/guest/" + guest_id + "/update";
          // ゲスト情報の更新
          let self = this;
          axios.post(apiUrl, this.guest).then(function (response) {
            // alert(apiUrl);
            // console.dir(response);
            self.guest = response.data.data;
          }).catch (function (error) {
            // console.dir(error)
          });
        }
      }
    });

    const Reserve = Vue.component("reserve" , {
      data: function () {
        return {
          guest: null,
        }
      },
      template: "#reserve",
      watch: {
        $route(to, from) {
          console.dir(to);
          console.dir(from);
        }
      }
    });

    const Service = Vue.component("service" , {
      data: function () {
        return {
          guest: null,
        }
      },
      template: "#service",
      watch: {
        $route(to, from) {
          console.dir(to);
          console.dir(from);
        }
      }
    });

    const router = new VueRouter({
      mode: "history",
      routes: [
        {
          path: "/guest/:id",
          name: "guest",
          component: Guest,
        },
        {
          path: "/reserve/:id",
          name: "reserve",
          component: Reserve,
        },
        {
          path: "/service/:id",
          name: "service",
          component: Service,
        }
      ]
    });

    let app=new Vue( {
      router: router,
      el: "#application",
      data: {
        services: [],
        reserves: [],
        guest: null,
      },
      created: function () {
        this.getServices();
      },
      updated: function () {
        // console.dir(this.$route.params);
      },
      mounted: function () {

      },
      methods: {
        getServices: function () {
          // リクエスト先エンドポイント
          let apiUrl=baseUrl+"/api/v1/front/service/list";
          let self = this;
          axios.get(apiUrl).then( function ( response ) {
            self.services = response.data.data;
          } ).catch( function ( error ) {
            // console.dir(error);
          } );
        },
        // 指定したサービスの予約状況を取得する
        getReserves: function (service_id) {
          // リクエスト先エンドポイント
          let apiUrl=baseUrl+"/api/v1/front/service/schedule/" + service_id;
          let self = this;
          axios.get(apiUrl).then( function ( response ) {
            // console.dir(response);
            self.reserves = response.data.data;
          } ).catch( function ( error ) {
            // console.dir(error);
          } );
        },
        moveGuestPage: function (guest_id) {
          // console.dir(this.$route);
          // console.dir(this.$router);
          this.$router.push({ name: 'guest', params: { id : guest_id } }).catch (function ( error ) {
            console.dir(error);
          });
        }
      }
    } );
  </script>
</body>

</html>